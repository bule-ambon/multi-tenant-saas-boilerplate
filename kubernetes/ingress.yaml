apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: saas-platform-ingress
  annotations:
    kubernetes.io/ingress.class: nginx
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/rate-limit: "100"
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
spec:
  tls:
  - hosts:
    - yourdomain.com
    - "*.yourdomain.com"
    - api.yourdomain.com
    secretName: saas-platform-tls
  rules:
  # Main frontend
  - host: yourdomain.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: saas-frontend
            port:
              number: 3000
  # Tenant subdomains
  - host: "*.yourdomain.com"
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: saas-frontend
            port:
              number: 3000
  # API backend
  - host: api.yourdomain.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: saas-backend
            port:
              number: 8000
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: saas-config
data:
  APP_NAME: "Multi-Tenant SaaS Platform"
  ENVIRONMENT: "production"
  LOG_LEVEL: "INFO"
  TENANCY_MODE: "shared"
  TENANT_IDENTIFICATION: "subdomain"
---
apiVersion: v1
kind: Secret
metadata:
  name: saas-secrets
type: Opaque
stringData:
  database-url: "postgresql://user:password@postgres:5432/saas_platform"
  redis-url: "redis://redis:6379/0"
  celery-broker-url: "redis://redis:6379/1"
  secret-key: "change-this-in-production-use-strong-random-key"
  stripe-secret-key: "sk_live_your_stripe_key"
  stripe-webhook-secret: "whsec_your_webhook_secret"
